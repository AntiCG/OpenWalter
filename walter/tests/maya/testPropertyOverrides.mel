// Copyright 2017 Rodeo FX.  All rights reserved.

proc int _testPropertyOverrides(string $dir, string $abcOverride, string $strRef)
{
    string $geoPath = $dir + "geometry.abc";
    string $attrPath = $dir + $abcOverride;
    string $assPath = $dir + "overrideAssembly.abc";
    string $nodePath = $geoPath + ":" + $attrPath + ":" + $assPath;
 
    string $node = wCreateStandin($nodePath);
    string $properties = `walterStandin -pa $node "/pSphere1/pTorus1/pTorusShape1"`;
        
    return 1 - (wFlattenString($properties) == wFlattenString($strRef));
}

global proc int testPropertyOverrides()
{
    // Directory to the alembics.
    string $dir = dirname(wGetCurrentDir()) + "/resources/alembics/propertyOverrides/";
    
    string $attributeOverride_1_ref = "{ \"prim\": \"/pSphere1/pTorus1/pTorusShape1\", \"properties\": [ { \"name\": \"displayColor\", \"type\": \"VtArray<GfVec3f>\", \"arraySize\": 0, \"value\": [] }, { \"name\": \"displayOpacity\", \"type\": \"VtArray<float>\", \"arraySize\": 0, \"value\": [] }, { \"name\": \"uv\", \"type\": \"VtArray<GfVec2f>\", \"arraySize\": 49, \"value\": [[0.000000, 1.000000], [0.166667, 1.000000], [0.333333, 1.000000], [0.500000, 1.000000], [0.666667, 1.000000], [0.833333, 1.000000], [1.000000, 1.000000], [0.000000, 0.833333], [0.166667, 0.833333], [0.333333, 0.833333], [0.500000, 0.833333], [0.666667, 0.833333], [0.833333, 0.833333], [1.000000, 0.833333], [0.000000, 0.666667], [0.166667, 0.666667], [0.333333, 0.666667], [0.500000, 0.666667], [0.666667, 0.666667], [0.833333, 0.666667], [1.000000, 0.666667], [0.000000, 0.500000], [0.166667, 0.500000], [0.333333, 0.500000], [0.500000, 0.500000], [0.666667, 0.500000], [0.833333, 0.500000], [1.000000, 0.500000], [0.000000, 0.333333], [0.166667, 0.333333], [0.333333, 0.333333], [0.500000, 0.333333], [0.666667, 0.333333], [0.833333, 0.333333], [1.000000, 0.333333], [0.000000, 0.166667], [0.166667, 0.166667], [0.333333, 0.166667], [0.500000, 0.166667], [0.666667, 0.166667], [0.833333, 0.166667], [1.000000, 0.166667], [0.000000, -0.000000], [0.166667, -0.000000], [0.333333, -0.000000], [0.500000, -0.000000], [0.666667, -0.000000], [0.833333, -0.000000], [1.000000, -0.000000]] }], \"overrides\": [ { \"name\": \"subdiv_iterations\", \"type\": \"int\", \"arraySize\": -1, \"value\": 3 }, { \"name\": \"subdiv_type\", \"type\": \"string\", \"arraySize\": -1, \"value\": \"catclark\" }, { \"name\": \"displacement\", \"type\": \"TfToken\", \"arraySize\": -1, \"value\": \"\" }, { \"name\": \"surface\", \"type\": \"TfToken\", \"arraySize\": -1, \"value\": \"\" }, { \"name\": \"volume\", \"type\": \"TfToken\", \"arraySize\": -1, \"value\": \"\" }] }";

    string $attributeOverride_2_ref = "{ \"prim\": \"/pSphere1/pTorus1/pTorusShape1\", \"properties\": [ { \"name\": \"displayColor\", \"type\": \"VtArray<GfVec3f>\", \"arraySize\": 0, \"value\": [] }, { \"name\": \"displayOpacity\", \"type\": \"VtArray<float>\", \"arraySize\": 0, \"value\": [] }, { \"name\": \"uv\", \"type\": \"VtArray<GfVec2f>\", \"arraySize\": 49, \"value\": [[0.000000, 1.000000], [0.166667, 1.000000], [0.333333, 1.000000], [0.500000, 1.000000], [0.666667, 1.000000], [0.833333, 1.000000], [1.000000, 1.000000], [0.000000, 0.833333], [0.166667, 0.833333], [0.333333, 0.833333], [0.500000, 0.833333], [0.666667, 0.833333], [0.833333, 0.833333], [1.000000, 0.833333], [0.000000, 0.666667], [0.166667, 0.666667], [0.333333, 0.666667], [0.500000, 0.666667], [0.666667, 0.666667], [0.833333, 0.666667], [1.000000, 0.666667], [0.000000, 0.500000], [0.166667, 0.500000], [0.333333, 0.500000], [0.500000, 0.500000], [0.666667, 0.500000], [0.833333, 0.500000], [1.000000, 0.500000], [0.000000, 0.333333], [0.166667, 0.333333], [0.333333, 0.333333], [0.500000, 0.333333], [0.666667, 0.333333], [0.833333, 0.333333], [1.000000, 0.333333], [0.000000, 0.166667], [0.166667, 0.166667], [0.333333, 0.166667], [0.500000, 0.166667], [0.666667, 0.166667], [0.833333, 0.166667], [1.000000, 0.166667], [0.000000, -0.000000], [0.166667, -0.000000], [0.333333, -0.000000], [0.500000, -0.000000], [0.666667, -0.000000], [0.833333, -0.000000], [1.000000, -0.000000]] }], \"overrides\": [ { \"name\": \"custom1\", \"type\": \"GfVec3f\", \"arraySize\": -1, \"value\": [1.000000, 0.000000, 0.000000] }, { \"name\": \"custom1B\", \"type\": \"float\", \"arraySize\": -1, \"value\": 0.000000 }, { \"name\": \"custom1G\", \"type\": \"float\", \"arraySize\": -1, \"value\": 0.000000 }, { \"name\": \"custom1R\", \"type\": \"float\", \"arraySize\": -1, \"value\": 1.000000 }, { \"name\": \"displacement\", \"type\": \"TfToken\", \"arraySize\": -1, \"value\": \"\" }, { \"name\": \"surface\", \"type\": \"TfToken\", \"arraySize\": -1, \"value\": \"\" }, { \"name\": \"volume\", \"type\": \"TfToken\", \"arraySize\": -1, \"value\": \"\" }] }";

    string $attributeOverride_3_ref = "{ \"prim\": \"/pSphere1/pTorus1/pTorusShape1\", \"properties\": [ { \"name\": \"displayColor\", \"type\": \"VtArray<GfVec3f>\", \"arraySize\": 0, \"value\": [] }, { \"name\": \"displayOpacity\", \"type\": \"VtArray<float>\", \"arraySize\": 0, \"value\": [] }, { \"name\": \"uv\", \"type\": \"VtArray<GfVec2f>\", \"arraySize\": 49, \"value\": [[0.000000, 1.000000], [0.166667, 1.000000], [0.333333, 1.000000], [0.500000, 1.000000], [0.666667, 1.000000], [0.833333, 1.000000], [1.000000, 1.000000], [0.000000, 0.833333], [0.166667, 0.833333], [0.333333, 0.833333], [0.500000, 0.833333], [0.666667, 0.833333], [0.833333, 0.833333], [1.000000, 0.833333], [0.000000, 0.666667], [0.166667, 0.666667], [0.333333, 0.666667], [0.500000, 0.666667], [0.666667, 0.666667], [0.833333, 0.666667], [1.000000, 0.666667], [0.000000, 0.500000], [0.166667, 0.500000], [0.333333, 0.500000], [0.500000, 0.500000], [0.666667, 0.500000], [0.833333, 0.500000], [1.000000, 0.500000], [0.000000, 0.333333], [0.166667, 0.333333], [0.333333, 0.333333], [0.500000, 0.333333], [0.666667, 0.333333], [0.833333, 0.333333], [1.000000, 0.333333], [0.000000, 0.166667], [0.166667, 0.166667], [0.333333, 0.166667], [0.500000, 0.166667], [0.666667, 0.166667], [0.833333, 0.166667], [1.000000, 0.166667], [0.000000, -0.000000], [0.166667, -0.000000], [0.333333, -0.000000], [0.500000, -0.000000], [0.666667, -0.000000], [0.833333, -0.000000], [1.000000, -0.000000]] }], \"overrides\": [ { \"name\": \"custom1\", \"type\": \"float\", \"arraySize\": -1, \"value\": 1.000000 }, { \"name\": \"custom2\", \"type\": \"int\", \"arraySize\": -1, \"value\": 2 }, { \"name\": \"custom3\", \"type\": \"int\", \"arraySize\": -1, \"value\": 3 }, { \"name\": \"custom4\", \"type\": \"float\", \"arraySize\": -1, \"value\": 4.000000 }, { \"name\": \"displacement\", \"type\": \"TfToken\", \"arraySize\": -1, \"value\": \"\" }, { \"name\": \"surface\", \"type\": \"TfToken\", \"arraySize\": -1, \"value\": \"\" }, { \"name\": \"volume\", \"type\": \"TfToken\", \"arraySize\": -1, \"value\": \"\" }] }";
 

    int $test_1 = _testPropertyOverrides($dir, "attributeOverride_1.abc", $attributeOverride_1_ref);
    int $test_2 = _testPropertyOverrides($dir, "attributeOverride_2.abc", $attributeOverride_2_ref);
    int $test_3 = _testPropertyOverrides($dir, "attributeOverride_3.abc", $attributeOverride_3_ref);

    return $test_1 + $test_2 + $test_3;
}
